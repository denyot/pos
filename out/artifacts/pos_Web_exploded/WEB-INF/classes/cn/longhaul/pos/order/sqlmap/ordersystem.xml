<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="posordersystem">
	<typeAlias alias="dto" type="org.eredlab.g4.ccl.datastructure.impl.BaseDto" />
	<!--订单原因 -->
	<select id="orderreson" parameterClass="map" resultClass="dto">
		select * from z_rfc_store_09_it_tvaut where 1=1
		<isNotEmpty prepend="and" property="auart">
			AUGRU like '$auart$%'
		</isNotEmpty>

	</select>

	<select id="vkorgType" parameterClass="map" resultClass="int">
		select VKORG from z_rfc_store_06_it_t001w where 1=1
		<isNotEmpty prepend="and" property="werks">
			werks= #werks#
		</isNotEmpty>
	</select>

	<select id="ordertype9000" parameterClass="map" resultClass="dto">
		select DISTINCT AUART pzdm, BEZEI pzmc FROM
		z_rfc_store_09_it_tvakt
		where AUART like 'ZJ%'
	</select>

	<select id="ordertype1000" parameterClass="map" resultClass="dto">
		select DISTINCT AUART pzdm, BEZEI pzmc FROM
		z_rfc_store_09_it_tvakt
		where AUART like 'ZY%'
	</select>
	<select id="ordertype1100" parameterClass="map" resultClass="dto">
		select DISTINCT AUART pzdm, BEZEI pzmc FROM
		z_rfc_store_09_it_tvakt
		where AUART like 'ZY%'
	</select>
	<select id="ordertype1200" parameterClass="map" resultClass="dto">
		select DISTINCT AUART pzdm, BEZEI pzmc FROM
		z_rfc_store_09_it_tvakt
		where AUART like 'ZY%'
	</select>
	<!-- 是否三倍积分-->
	<select id="getStreejf" parameterClass="map" resultClass="dto">
		select sum(if(ORDERTYPE = 'ZYR1',-1,1))  AS huitou from aig_orderhead 
		WHERE ORDERTYPE in( 'ZYR1','ZYS2','ZYS1')
		and CUSTOMERID = (
		select KUNNR from z_rfc_store_05_gt_vip where sort2 = #vipid#
		 AND (extract(month from gbdat) = extract(month from #saledate#)
			  or extract(month from telf2) = extract(month from #saledate#)
		)limit 1 
		)
	</select> 
	<select id="ordertype" parameterClass="map" resultClass="dto">
		select DISTINCT AUART pzdm, BEZEI pzmc FROM
		z_rfc_store_09_it_tvakt
		<isNotEmpty prepend="where" property="ordertype">
			AUART= #ordertype#
		</isNotEmpty>
	</select>

	<select id="getpospassword" parameterClass="map" resultClass="String">
		select YHKL from sq_yhxx where trim(yhdlm)=#userid#
	</select>

	<select id="getsaleman" parameterClass="map" resultClass="dto">
		SELECT
		* FROM aig_assistant_info where store_number=#werks# and status != 2
	</select>

	<select id="getswerkssaleflag" parameterClass="map" resultClass="String">
		select PTBZ Xsbj from z_rfc_store2_06_it_t001w where WERKS=#werks#
	</select>
	
	<select id="getAccountFlag" parameterClass="map" resultClass="String">
		select isgo from sap_account_date limit 1
	</select>

	<select id="ordertypeall" parameterClass="map" resultClass="dto">
		select * from z_rfc_store_09_it_tvakt
	</select>

	<select id="getgiftjf" parameterClass="map" resultClass="Integer">
		select kdjf from xt_lppmbm where 1=1
		<isNotEmpty prepend="and" property="charg">
			lppmbm= #charg#
		</isNotEmpty>
	</select>
	<!-- 取出最后一次销售批次的价钱 -->
	<select id="getchargbaklastprice" parameterClass="map" resultClass="dto">
		select a.SAPSALESORDERID, a.SALESORDERID,
		a.UNIONPAY,a.VIPCARD,a.SHOPPINGCARD, b.* from aig_orderitem b
		inner
		join aig_orderhead a on a.SALESORDERID = b.SALESORDERID
		where 1=1 AND ORDERITEMTYPE != 'ZIN'
		AND ORDERITEMTYPE != 'ZIN1'
		<isNotEmpty prepend="and" property="charg">
			b.batchnumber=#charg#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="matnr">
			b.materialnumber=#matnr#  
		     </isNotEmpty>
		<!-- <isNotEmpty prepend="and" property="vipid">
			a.vipcard=#vipid#
		</isNotEmpty>  -->
		<isNotEmpty prepend="and" property="ordertype">
			a.ordertype in
			<iterate property="ordertype" conjunction="," open="(" close=")">
				#ordertype[]#
			</iterate>
		</isNotEmpty>
              <![CDATA[order by a.OPERATEDATETIME desc limit 1]]>
	</select>

	<!-- 取出最后一次销售批次的价钱(从SAP中获取数据) -->
	<select id="getchargbaklastpriceforsap" parameterClass="map" resultClass="dto">
		select OVBELN SAPSALESORDERID, OVBELN SALESORDERID,
		KBETRX3 UNIONPAY,SORT2
		VIPCARD,KBETRX2 SHOPPINGCARD, KBETRZ4 selfprivilege, KBETRZ5 selfticketprice,
		KBETRZ6 marketprivilege,
		KBETRZ7
		marketticketprice,KBETRZ8 currentintegral, KBETRZ9 vipintegral,JS
		salesquantity,
		KBETRX4 totalamount,
		IFNULL((select ZCLZL from
		z_rfc_store_03_it_charg where charg=#charg#),HPZL) goldweight
		from
		z_rfc_store_47_it_ztls
		where 1=1 AND PSTYV != 'ZIN' AND PSTYV != 'ZIN1'
		<isNotEmpty prepend="and" property="charg">
			(CHARG=#charg# or
			OCHARG=#charg#)
		</isNotEmpty>
		<!-- <isNotEmpty prepend="and" property="matnr"> b.materialnumber=#matnr# </isNotEmpty> -->
		<!-- <isNotEmpty prepend="and" property="vipid">
			SORT2=#vipid#
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="ordertype">
			AUART in
			<iterate property="ordertype" conjunction="," open="(" close=")">
				#ordertype[]#
			</iterate>
		</isNotEmpty>
              <![CDATA[order by AUDAT desc limit 1]]>
	</select>

	<select id="getchargisusedorderid" parameterClass="map" resultClass="String">
		select a.salesorderid from aig_orderitem a ,aig_orderhead
		b where
		a.salesorderid=b.salesorderid and
		a.batchnumber=#charg# and
		b.orderflag
		in('NO','UO') limit 0,1
	</select>
	<select id="viprecord" parameterClass="map" resultClass="dto">
	
		<![CDATA[
			   select a.KUNNR hybh,a.NAME1 hyxm, a.SORT1 sj, a.TELF1 telf,a.SORT2 hykh from z_rfc_store_05_gt_vip a 
			   where 1=1 and name1 not in ('未分配会员卡','未激活会员卡','未激活卡号')
    	]]>
		<dynamic>
			<isNotEmpty prepend="and" property="kunnr">
			<![CDATA[(]]>
				a.KUNNR like '$kunnr$%'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="vipid">
			<![CDATA[(]]>
				a.SORT2 like '$vipid$%'
			</isNotEmpty>
			<isNotEmpty prepend="or" property="tel">
				a.SORT1 = #tel#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="vipid">
				a.TELF1 = #kunnr#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="vipid">
				a.NAME1 = #kunnr#
			</isNotEmpty>
			<![CDATA[)]]>
			<isNotEmpty prepend=" " property="rownum">
				limit 0,#rownum#
			</isNotEmpty>
		</dynamic>
	</select>

	<select id="viprecordbyuser" parameterClass="map" resultClass="dto">
		select a.KUNNR hybh,a.NAME1 hyxm, a.TELF1 telf , a.SORT1 sj,a.SORT2
		hykh , zjf, FAX_NUMBER, GBDAT,TELF2,TEL_NUMBER joindate from
		z_rfc_store_05_gt_vip a
		WHERE 1 = 1 
		<dynamic>
			<!-- <isNotEmpty prepend="and" property="vipid">
				a.SORT2 = #vipid# 
			</isNotEmpty>
			 -->
			<isNotEmpty prepend="and" property="vipid">
			<![CDATA[(]]>
				a.KUNNR =#vipid#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="vipid">
				a.SORT2 = #vipid#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="tel">
				a.SORT1 = #tel#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="vipid">
				a.TELF1 = #vipid#
			</isNotEmpty>
			<isNotEmpty prepend="or" property="vipid">
				a.NAME1 = #vipid#
			</isNotEmpty>
			<![CDATA[)]]>
			<!-- <isNotEmpty prepend=" " property="rownum"> limit 0,#rownum# </isNotEmpty> -->
		</dynamic>
	</select>
	
	<!-- 
	<select id="getpcxx" parameterClass="map" resultClass="dto">
		select a.CHARG cpbm ,b.MAKTX plmc,a.MATNR bkbh, b.ZMATNRT zp,b.ZJLBM
		sjczbm
		from z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara
		b on
		a.MATNR = b.MATNR
		where ((select labst from z_rfc_store_46_it_stock where werks=#werks#
		and (lgort='0001' or lgort = '0017') and charg=a.charg) > 0 or (select labst from z_rfc_store_48_it_stock where werks=#werks#
		and (lgort='0001' or lgort = '0017') and
		charg=a.charg) > 0)
		<dynamic>
			<isNotEmpty prepend="and" property="charg">
				(a.CHARG like
				'$charg$%'
				or CHARG_O like '$charg$%' )
			</isNotEmpty>
		</dynamic>
		 <![CDATA[   limit 0,10]]>
	</select>
	 -->
	 
	<select id="getpcxx" parameterClass="map" resultClass="dto">
		select a.CHARG cpbm ,IF(TRIM(a.ZTXT1) = '' or ISNULL(a.ZTXT1),b.MAKTX,a.ZTXT1) plmc,a.MATNR bkbh, b.ZMATNRT zp,b.ZJLBM sjczbm
		from z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara b on a.MATNR = b.MATNR
		where (a.CHARG = '$charg$' or CHARG_O = '$charg$')
	</select>
	
	<select id="getStock_46" parameterClass="dto" resultClass="Double">
		select labst 
		from z_rfc_store_46_it_stock a
		LEFT JOIN z_rfc_store_03_it_charg b on a.charg = b.charg
		where a.werks=#werks# and (a.lgort='0001' or a.lgort = '0017') 
		and (b.CHARG like '$charg$%' or b.CHARG_O like '$charg$%' ) and labst > 0
	</select>
	
	<select id="getStock_48" parameterClass="dto" resultClass="Double">
		select labst 
		from z_rfc_store_48_it_stock a
		LEFT JOIN z_rfc_store_03_it_charg b on a.charg = b.charg
		where a.werks=#werks# and (a.lgort='0001' or a.lgort = '0017') 
		and (b.CHARG like '$charg$%' or b.CHARG_O like '$charg$%' ) and labst > 0
	</select>

	<select id="getMatnrInfo" parameterClass="map" resultClass="dto">
		select MATNR, MAKTX from z_rfc_store_01_it_mara where
		MATKL in
		('BC','ZP','GF','BG','DJ','VI','G')
		<dynamic>
			<isNotEmpty prepend="and" property="matnr">
				matnr like '$matnr$%'
			</isNotEmpty>
		</dynamic>
		 <![CDATA[   limit 0,10]]>
	</select>

	<!-- select a.CHARG cpbm,a.ZHLHX plbm,a.ZHLHXT plmc,b.ZTJTF bqj,c.ZTJTE sxj,a.ZJLZL1 jlzl, b.LGORT, NULL zszl,a.ZZSH zsh,a.ZTJCD xsgf,a.MATNR bkbh ,NULL zp,a.ZJJFL sjczbm from z_rfc_store2_03_it_ztbhd 
		a inner join z_rfc_store2_initial_it_tab b on a.CHARG = b.CHARG inner join z_rfc_store2_04_it_ztbjg c on a.CHARG = c.CHARG where b.LABST>0 -->

	<select id="getpcxxbyuser" parameterClass="map" resultClass="dto">
		select a.CHARG cpbm,b.meins ,NULL plbm,
		<!-- 
		CONCAT(ifnull((select maktx from z_rfc_store_29_it_zttj where CHARG=a.charg and  DATS <![CDATA[<=]]> current_date and DATF >= current_date order by SHRQ DESC  limit 1),maktx),
		(case a.ZFMNN when '' then ''
		when null then '' ELSE (select CONCAT('(',YMIAOSHU,')')
		from z_rfc_store_07_it_zpumb where YBIANM = a.ZFMNN limit 1) END)) plmc,
		 -->
		 IF(TRIM(a.ZTXT1) = '' or ISNULL(a.ZTXT1),CONCAT(b.MAKTX,(case a.ZFMNN when '' then '' when null then '' ELSE (select CONCAT('(',YMIAOSHU,')')
		from z_rfc_store_07_it_zpumb where YBIANM = a.ZFMNN limit 1) END)),a.ZTXT1) plmc,
		ifnull((select kbetr from z_rfc_store_04_gt_zpcjg where charg=a.charg and matnr = a.matnr and KUNRE like '$werks$%' and DATAB <![CDATA[<=]]>
		current_date and DATBI >= current_date order by DATAB desc limit 1),
		(select kbetr from z_rfc_store_04_gt_zpcjg where charg=a.charg and matnr = a.matnr  and DATAB <![CDATA[<=]]>
		current_date and DATBI >= current_date order by DATAB desc limit 1)
		)bqj
		,a.ZCLZL jlzl,null zszl,null zsh,
		null xsgf,a.MATNR bkbh, a.ZMATNRT zp,a.hpzl, b.ZJLBM sjczbm,
		ifnull((select labst from z_rfc_store_46_it_stock where werks=#werks# and charg=a.charg and (lgort='0001' or lgort = '0017') and labst>0 limit 1),
		(select labst
		from z_rfc_store_48_it_stock where werks=#werks# and charg=a.charg and (lgort='0001' or lgort = '0017') and labst>0 limit 1)) labst,
		ifnull((select lgort from z_rfc_store_46_it_stock where werks=#werks# and charg=a.charg and (lgort='0001' or lgort = '0017')  and labst>0 limit 1),
		(select lgort
		from z_rfc_store_48_it_stock where werks=#werks# and charg=a.charg and (lgort='0001' or lgort = '0017') and labst>0 limit 1)) lgort,
		<!-- '0001' lgort, -->
		 b.MATKL,
		(select KBSTAT from z_rfc_store_04_gt_zpcjg where charg=a.charg and matnr = a.matnr
		and KUNRE like '$werks$%' and
		DATAB <![CDATA[<=]]>
		#saledate# and DATBI >= #saledate# order by DATAB desc limit 1) KBSTAT,b.BISMT,(select
		max(kosrt) from z_rfc_store_02_it_zpjg where charg = a.charg and kschl='ZZH1'and kunre like '$werks$%') kosrt , b.extwg,a.CHARG_O, b.kondm,
		(select ZXSFS from
		z_rfc_store_32_it_ztzdfs where kondm=b.kondm and werks=#werks# LIMIT 1) goldsealmethod,
		(select kbetr from z_rfc_store_02_it_zpjg where kunre like '$werks$%' and
		kschl in ('ZZK5','ZZK4') and kondm=b.kondm and
		DATAB <![CDATA[<=]]>
		#saledate# and DATBI >= #saledate# limit 1) ckxx
		from z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara b on a.MATNR = b.MATNR
		<!-- left join z_rfc_store_46_it_stock d on a.CHARG = d.CHARG -->
		where a.CHARG = #charg# or a.CHARG_O = #charg#
		limit 1
	</select>
	
	
	<select id="getAllLabst" parameterClass="dto" resultClass="Integer" >
		<!-- select sum(labst) from z_rfc_store_46_it_stock where werks=#werks# and charg=#charg# -->
		select SALESQUANTITY from (
			select SALESQUANTITY from aig_orderitem where batchnumber = #charg# ORDER BY SALESORDERID desc
		)  aaa limit 1
	</select>

	<select id="getMatnrInfobyuser" parameterClass="map" resultClass="dto">
		select *,(select kbetr from z_rfc_store_02_it_zpjg where
		KONDM = a.KONDM and KUNRE=#werks# and KSCHL='ZZKD') KBETR,
		(case matkl when 'ZP' then '0014' when 'BC' then '0012' else '' end)lgort 
		 from
		z_rfc_store_01_it_mara a where 1=1
		<dynamic>
			<isNotEmpty property="charg" prepend="and">
				 matnr = #charg#
			</isNotEmpty>
			<isEmpty property="charg" prepend="and">
				 matnr = #matnr#
			</isEmpty>
		</dynamic>
		and MATKL in
		('BC','ZP','GF','BG','DJ','JJ','VI','G') limit 1
	</select>

	<select id="getgift" parameterClass="map" resultClass="dto">
	  	 <![CDATA[  
	  	    select distinct a.matnr cpbm, a.maktx plmc from z_rfc_store_01_it_mara a 
	  	     where 1=1 and (select labst from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) > 0
	  	]]>
		<dynamic>
			<isNotEmpty property="matnr" prepend="and">
				a.MATNR like
				'$matnr$%'
	  		</isNotEmpty>
			<isNotEmpty property="priceBetween" prepend="and">
				TBTXT in
				<iterate property="priceBetween" open="(" close=")" conjunction=",">
					#priceBetween[]#
	  			</iterate>
			</isNotEmpty>
			<isEmpty property="priceBetween" prepend="and">
				1 != 1
	  		</isEmpty>
			<!--<isNotEmpty property="werks" prepend="and"> b.werks = #werks# </isNotEmpty> -->
		</dynamic><!-- limit 0,10 -->
	</select>

	<select id="getGoldBar" parameterClass="map" resultClass="dto">
	  	 <![CDATA[  
	  	    select distinct a.matnr cpbm, a.maktx plmc,(
	  	    ifnull((select labst from z_rfc_store_20_gt_stock where matnr = a.matnr and werks = #werks# and lgort = '0001'),0) +
			ifnull((select labst from z_rfc_store_48_it_stock where matnr = a.matnr and werks = #werks# and lgort = '0001' and (charg='' or charg is null)),0)
	  	    ) labst
	  	     from z_rfc_store_01_it_mara a 
	  	     where a.kondm = 11 and (
	  	      ifnull((select labst from z_rfc_store_20_gt_stock where matnr = a.matnr and werks = #werks# and lgort = '0001'),0) +
			ifnull((select labst from z_rfc_store_48_it_stock where matnr = a.matnr and werks = #werks# and lgort = '0001' and (charg='' or charg is null)),0)
			)>0
	  	]]>
	</select>


	<select id="getgiftbyuser" parameterClass="map" resultClass="dto">
	   <![CDATA[  
	  	    select a.matnr cpbm, a.maktx plmc , (select lgort from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) lgort,
	  	    (select labst from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) labst,a.matkl from z_rfc_store_01_it_mara a
	  	     where 1=1 and (select labst from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) > 0
	  	]]>
		<dynamic>
			<isNotEmpty property="matnr" prepend="and">
				a.MATNR = '$matnr$'
			</isNotEmpty>
			<isNotEmpty property="priceBetween" prepend="and">
				TBTXT in
				<iterate property="priceBetween" open="(" close=")" conjunction=",">
					#priceBetween[]#
	  			</iterate>
			</isNotEmpty>
			<!--<isNotEmpty property="werks" prepend="and"> b.werks = #werks# </isNotEmpty> -->
		</dynamic>
		limit 1
	</select>

	<select id="getbcbyuser" parameterClass="map" resultClass="dto">
	   <![CDATA[  
	  	    select a.matnr cpbm, a.maktx plmc , (select lgort from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0012' limit 1) lgort,
	  	    (select labst from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0012' limit 1) labst,a.matkl from z_rfc_store_01_it_mara a
	  	     where 1=1 and (select labst from z_rfc_store_20_gt_stock where matnr=a.matnr and werks=#werks# and lgort='0012' limit 1) > 0
	  	]]>
		<dynamic>
			<isNotEmpty property="matnr" prepend="and">
				a.MATNR = '$matnr$'
			</isNotEmpty>
		</dynamic>
		limit 1
	</select>

	<select id="getgoldprices" parameterClass="map" resultClass="dto">
		select goldvalue drjj from aig_dailygold where 1=1
		<dynamic>
			<isNotEmpty prepend="and" property="werks">
				storenumbers = #werks#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="date">
				golddate like '$date$%'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="chargtype">
				goldtype = #chargtype#
			</isNotEmpty>
		</dynamic>
		order by golddate desc limit 1
	</select>
	<select id="getgoldprices1000" parameterClass="map" resultClass="dto">
		select ztjac drjj from z_rfc_store_25_it_zjj where
		MATNR=(select matnr
		from z_rfc_store_27_it_zjlgx where ZJLBN =#chargtype#)
		<dynamic>
			<isNotEmpty prepend="and" property="date">
				ERDAT like '$date$%'
			</isNotEmpty>
		</dynamic>
		order by UZEIT desc limit 1
	</select>

	<select id="getGoldqzbl" parameterClass="dto" resultClass="Double">
		select ZQZBL from z_rfc_store_27_it_ztjlnn where ZJLBN = #chargtype#
	</select>


	<!-- 根据部门时间选择最大序列号 -->
	<select id="getmaxorder" parameterClass="map" resultClass="java.lang.String">
		select max(salesOrderId) from aig_orderhead where storeid = #storeid#
		and
		DAYOFYEAR(insertdatetime) = DAYOFYEAR(#insertdatetime#)
	</select>
	
	<!-- 根据日期与门店直接计算出订单号 -->
	<select id="getsaleorderid" parameterClass="map" resultClass="java.lang.String">
		select if((select IFNULL(max(salesOrderId),'') from aig_orderhead where storeid=#storeid# and DAYOFYEAR(insertdatetime)=DAYOFYEAR(#insertdatetime#))='',
		CONCAT(#storeid#,DATE_FORMAT(#insertdatetime#,'%Y%m%d'),'001'),
		CONCAT(#storeid#,DATE_FORMAT(#insertdatetime#,'%Y%m%d'), 
		LPAD((SUBSTRING((select max(salesOrderId) from aig_orderhead where storeid=#storeid# and DAYOFYEAR(insertdatetime)=DAYOFYEAR(#insertdatetime#)),13)+1),
		3,'00')))
	</select>

	<!-- 插入订单主表记录 -->
	<insert id="createorderhead" parameterClass="dto">
		insert into
		aig_orderhead (salesorderid,operatedatetime,sapsalesorderid,ordertype,
		salepromotioncode,orderreason,storeid,operator,remarks,depositid,saledate,customerid,
		cashcoupon,salesclerk,storereceipt,paymentaccno,amountcollected,paymentmethod,vipcard,
		orderflag,deliverydate,cardexpired,totalmoney,resalesorderid,vipname,statementid,insertdatetime
		,cash,unionpay,shoppingcard,subscription,referrer,thankIntegral,currentIntegral,choiceorderid)
		values(
		#salesorderid#,#operatedatetime#
		,#sapsalesorderid#,#ordertype#,
		#salepromotioncode#,#orderreason#,#storeid#,#operator#,#remarks#,#depositid#,#saledate#,#customerid#,
		#cashcoupon#,#salesclerk#,#storereceipt#,#paymentaccno#,#amountcollected#,#paymentmethod#,#vipcard#,
		#orderflag#,#deliverydate#,#cardexpired#,#totalmoney#,#resalesorderid#,#vipname#,#statementid#,
		#insertdatetime#,#cash#,#unionpay#,#shoppingcard#,#subscription#,#referrer#,#thankIntegral#,#currentIntegral#,#choiceorderid#
		)
	</insert>
	<!-- 插入订单主表记录 -->
	<insert id="createorderitem" parameterClass="dto">
		insert into
		aig_orderitem
		(salesorderid,salesorderitem,upsalesorderitem,orderitemtype,
		storeid,materialnumber,batchnumber,salesquantity,storagelocation,netprice,
		goodsprocessingfee,goldprice,totalamount,tagprice,goldweight,customersdiscount,
		storediscount,unit,changefee,otherfee,exchangepint,lowerlevelsnumber,productpictureurl,
		statementid,settlementrate,settlementamount,originalsettlementrate,originalsettlementamount,
		materialclassificationcode,materialdesc,discount1,discount2,discount3,discount4,discount5,marketprivilege,
		selfticketprice,vipintegral,selfprivilege,marketticketprice,currentIntegral,salepromotion,giftMethod,depreciationPrice,settlegoldvalue,realitygoldvalue
		)
		values(
		#salesorderid#,#salesorderitem#,#upsalesorderitem#,#orderitemtype#,
		#storeid#,#materialnumber#,#batchnumber#,#salesquantity#,#storagelocation#,#netprice#,
		#goodsprocessingfee#,#goldprice#,#totalamount#,#tagprice#,#goldweight#,#customersdiscount#,
		#storediscount#,#unit#,#changefee#,#otherfee#,#exchangepint#,#lowerlevelsnumber#,#productpictureurl#,
		#statementid#,#settlementrate#,#settlementamount#,#originalsettlementrate#,#originalsettlementamount#,
		#materialclassificationcode#,#materialdesc#,#discount1#,#discount2#,#discount3#,#discount4#,#discount5#,#marketprivilege#,
		#selfticketprice#,#vipintegral#,#selfprivilege#,#marketticketprice#,#currentIntegral#,#salepromotion#,#giftMethod#,#depreciationPrice#,#settlegoldvalue#,#realitygoldvalue#
		) 
	</insert>

	<select id="getorderitem" parameterClass="map" resultClass="dto">
		select *
		from aig_orderitem
		where salesorderid=#salesorderid# order by
		-salesorderitem desc, upsalesorderitem
	</select>

	<select id="getorddeleritem" parameterClass="map" resultClass="dto">
		select
		salesorderid,salesorderitem,upsalesorderitem,orderitemtype,storeid,materialnumber,batchnumber,
		salesquantity,storagelocation,netprice,goodsprocessingfee,goldprice,totalamount,
		tagprice,goldweight,customersdiscount,storediscount,unit,changefee,otherfee,exchangepint,
		lowerlevelsnumber,productpictureurl,statementid,settlementrate,settlementamount,
		originalsettlementrate,originalsettlementamount,materialclassificationcode,materialdesc
		from aig_orderitem
		where salesorderid=#salesorderid# and salesorderitem
		in
		<iterate property="delist" open="(" close=")" conjunction=",">
			#delist[]#  
        </iterate>
	</select>

	<select id="getorderhead" parameterClass="map" resultClass="dto">
		select *
		from aig_orderhead
		where salesorderid=#salesorderid# 
	</select>

	<select id="getorderheads" parameterClass="map" resultClass="dto">
		select *
		from aig_orderhead
		where
		salesorderid in
		<iterate property="orderIds" open="(" close=")" conjunction=",">
			#orderIds[]#  
        </iterate>

	</select>

	<select id="getorderheadbyuser" parameterClass="map" resultClass="dto">
		select salesorderid,operatedatetime
		operatedatetime,sapsalesorderid,ordertype,
		salepromotioncode,orderreason,storeid,
		operator,remarks,depositid,saledate,customerid,cashcoupon,salesclerk,storereceipt,
		paymentaccno,amountcollected,paymentmethod,vipcard,orderflag,deliverydate,cardexpired,
		totalmoney,resalesorderid,vipname,statementid,deliveryordernumber,materialdocumber,
		cash,unionpay,shoppingcard,subscription,
		(select sum(SALESQUANTITY)
		from aig_orderitem where SALESORDERID=head.SALESORDERID) totalcount
		from aig_orderhead head
		where 1=1
		<isNotEmpty prepend="and" property="salesorderid">
			salesorderid like
			'%$salesorderid$'  
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="saledatefrom">
			saledate
	   </isNotEmpty>
		<isNotEmpty prepend="between" property="saledatefrom">
			#saledatefrom#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="saledateto">
			#saledateto#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="sapsalesorderid">
			sapsalesorderid like
			'%$sapsalesorderid$'  
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="kunnr">
			customerid like
			'%$kunnr$'   
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="vipid">
			vipcard like
			'%$vipid$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="ordertype">
			ordertype in 
			<iterate property="ordertype" open="(" close=")" conjunction=",">
					#ordertype[]#
			</iterate>
		</isNotEmpty>
		<isEmpty prepend="and" property="ordertype">
			ordertype <![CDATA[ <> ]]> 'ZYS6'
		</isEmpty>
		<isNotEmpty prepend="and" property="orderflag">
			orderflag= #orderflag#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="werks">
			storeid= #werks#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="salesclerk">
			salesclerk= #salesclerk#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operator">
			operator= #operator#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="deliveryordernumber">
			deliveryordernumber like
			'%$deliveryordernumber$'  
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="batchno">
			(select count(*) from
			aig_orderitem item where BATCHNUMBER like #batchno#
			and
			head.salesorderid
			=item.salesorderid) > 0
		</isNotEmpty>
	   
	    <![CDATA[  order by SALEDATE desc, salesorderid  desc ]]>
	</select>

	<select id="getOrderDetail" parameterClass="map" resultClass="dto">
		select head.salesorderid,operatedatetime
		operatedatetime,sapsalesorderid,ordertype,
		salepromotioncode,orderreason,head.storeid,
		operator,remarks,depositid,saledate,customerid,cashcoupon,salesclerk,storereceipt,
		paymentaccno,amountcollected,paymentmethod,vipcard,orderflag,deliverydate,cardexpired,
		totalmoney,resalesorderid,vipname,head.statementid,deliveryordernumber,materialdocumber,
		cash,unionpay,shoppingcard,subscription,
		(select sum(SALESQUANTITY)
		from aig_orderitem where
		SALESORDERID=head.SALESORDERID) totalcount,
		head.*,item.*,mara.zmatnrt,
		(select tslbm from z_rfc_store_09_it_sl where zslbm = mara.zslbm) zslbm,
		(select zjlms from z_rfc_store_09_it_jl where zjlbn =
		mara.zjlbm)
		zjlbm,
		(select ZDSZN from z_rfc_store_08_it_zslit where zzfst = 1 and
		TMHNN=item.batchnumber limit 1) ZZLNN,

		(case (ifnull((select LABOR from z_rfc_store_45_it_zcharg_zs where charg=item.batchnumber limit 1),
		(select LABOR from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1)))
		when '' then (select LABOR from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1) ELSE
		(ifnull((select LABOR from z_rfc_store_45_it_zcharg_zs where charg=item.batchnumber limit 1),
		(select LABOR from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1))) END ) LABOR,

		(case (ifnull((select ZSLYS from z_rfc_store_45_it_zcharg_zs where charg=item.batchnumber limit 1),
		(select ZSLYS from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1)))
		when '' then (select ZSLYS from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1) ELSE
		(ifnull((select ZSLYS from z_rfc_store_45_it_zcharg_zs where charg=item.batchnumber limit 1),
		(select ZSLYS from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1))) END ) ZSLYS,

		<!-- (select tsljd from z_rfc_store_09_it_zsjd where zsljd=(select LABOR from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1)) LABOR, (select tslys from z_rfc_store_09_it_slys 
			where zslys=(select ZSLYS from z_rfc_store_08_it_zslit where zzfst = 1 and TMHNN=item.batchnumber limit 1)) ZSLYS, -->
		(select ZSZSB from z_rfc_store_08_it_zslit where zzfst = 1 and
		TMHNN=item.batchnumber limit 1) ZSZSB
		from aig_orderhead head inner
		join aig_orderitem item on head.salesorderid=item.salesorderid
		left
		join z_rfc_store_01_it_mara mara on item.materialnumber = mara.matnr
		where 1=1
		<isNotEmpty prepend="and" property="salesorderid">
			head.salesorderid like
			'%$salesorderid$'  
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="saledatefrom">
			saledate
	   </isNotEmpty>
		<isNotEmpty prepend="between" property="saledatefrom">
			#saledatefrom#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="saledateto">
			#saledateto#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="sapsalesorderid">
			head.sapsalesorderid
			like
			'%$sapsalesorderid$'  
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="kunnr">
			customerid like
			'%$kunnr$'   
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="vipid">
			vipcard like
			'%$vipid$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="ordertype">
				ordertype in 
				<iterate property="ordertype" open="(" close=")" conjunction=",">
					#ordertype[]#
				</iterate>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="orderflag">
			orderflag= #orderflag#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="werks">
			head.storeid= #werks#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="salesclerk">
			salesclerk= #salesclerk#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operator">
			operator= #operator#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="deliveryordernumber">
			deliveryordernumber like
			'%$deliveryordernumber$'  
	   </isNotEmpty>

		<isNotEmpty prepend="and" property="kondm">
			mara.kondm = #kondm#
	   </isNotEmpty>

		<isNotEmpty prepend="and" property="batchno">
			(select count(*) from
			aig_orderitem item where BATCHNUMBER like #batchno#
			and
			head.salesorderid
			=item.salesorderid) > 0
		</isNotEmpty>
	   
	    <![CDATA[  order by SALEDATE desc, head.salesorderid  desc ]]>
	</select>


	<select id="getOldOrderDetail" parameterClass="map" resultClass="dto">
		select a.OVBELN sapsalesorderid ,a.OVBELN salesorderid ,(select BEZEI from z_rfc_store_09_it_tvakt where AUART = a.AUART) ordertypetext,a.AUART ordertype , a.AUDAT saledate,
		a.SORT2 vipcard,a.KBETRY3 totalmoney,a.KBETRY1 tagprice,a.charg batchnumber,b.MATNR materialnumber
		,(select maktx from z_rfc_store_01_it_mara where matnr = b.MATNR) materialdesc,a.JS salesquantity,a.KBETRZ8 currentintegral
		 from z_rfc_store_47_it_ztls a left join z_rfc_store_03_it_charg b on a.CHARG=b.CHARG  where 1=1
		<!-- <isNotEmpty prepend="and" property="saledatefrom">
			saledate
	   </isNotEmpty>
		<isNotEmpty prepend="between" property="saledatefrom">
			#saledatefrom#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="saledateto">
			#saledateto#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="kunnr">
			customerid like
			'%$kunnr$'   
	   </isNotEmpty> -->
		<isNotEmpty prepend="and" property="vipid">
			a.SORT2 like 
			'%$vipid$%'
		</isNotEmpty>
		<!-- <isNotEmpty prepend="and" property="ordertype">
			ordertype= #ordertype#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="werks">
			head.storeid= #werks#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="kondm">
			mara.kondm = #kondm#
	   </isNotEmpty>
		<isNotEmpty prepend="and" property="batchno">
			(select count(*) from
			aig_orderitem item where BATCHNUMBER like #batchno#
			and
			head.salesorderid
			=item.salesorderid) > 0
		</isNotEmpty> -->
	   
	    <![CDATA[  order by SALEDATE desc, a.OVBELN  desc ]]>
	</select>



	<select id="getorderheadbyuserForPageCount" parameterClass="map" resultClass="java.lang.Integer">
		SELECT count(*) as count
		from aig_orderhead head WHERE 1=1 and ordertype <![CDATA[ <> ]]> 'ZYS6'
		<dynamic>
			<isNotEmpty prepend="and" property="salesorderid">
				salesorderid like
				'%$salesorderid$'  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="saledatefrom">
				saledate
			   </isNotEmpty>
			<isNotEmpty prepend="between" property="saledatefrom">
				#saledatefrom#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="saledateto">
				#saledateto#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="sapsalesorderid">
				sapsalesorderid like
				'%$sapsalesorderid$'  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="kunnr">
				customerid like
				'%$kunnr$'   
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="vipid">
				vipcard like '%$vipid$'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ordertype">
			ordertype in 
				<iterate property="ordertype" open="(" close=")" conjunction=",">
					#ordertype[]#
				</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="and" property="orderflag">
				orderflag= #orderflag#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="werks">
				storeid= #werks#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="salesclerk">
				salesclerk=
				#salesclerk#  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="operator">
				operator= #operator#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="batchno">
				(select count(*) from
				aig_orderitem item where BATCHNUMBER like #batchno#
				and
				head.salesorderid
				=item.salesorderid) > 0
			   </isNotEmpty>
		</dynamic>
	</select>


	<select id="getOrderDetailForPageCount" parameterClass="map" resultClass="java.lang.Integer">
		SELECT count(*) as count
		from aig_orderhead head inner join
		aig_orderitem item on head.salesorderid=item.salesorderid WHERE 1=1
		<dynamic>
			<isNotEmpty prepend="and" property="salesorderid">
				head.salesorderid like
				'%$salesorderid$'  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="saledatefrom">
				saledate
			   </isNotEmpty>
			<isNotEmpty prepend="between" property="saledatefrom">
				#saledatefrom#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="saledateto">
				#saledateto#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="sapsalesorderid">
				sapsalesorderid like
				'%$sapsalesorderid$'  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="kunnr">
				customerid like
				'%$kunnr$'   
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="vipid">
				vipcard like '%$vipid$'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ordertype">
				ordertype in 
				<iterate property="ordertype" open="(" close=")" conjunction=",">
					#ordertype[]#
				</iterate>
		</isNotEmpty>
			<isNotEmpty prepend="and" property="orderflag">
				orderflag= #orderflag#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="werks">
				head.storeid= #werks#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="salesclerk">
				salesclerk=
				#salesclerk#  
			   </isNotEmpty>
			<isNotEmpty prepend="and" property="operator">
				operator= #operator#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="batchno">
				(select count(*) from
				aig_orderitem item where BATCHNUMBER like #batchno#
				and
				head.salesorderid
				=item.salesorderid) > 0
			   </isNotEmpty>
		</dynamic>
	</select>

	
	<select id="getOldOrderDetailForPageCount" parameterClass="map" resultClass="java.lang.Integer">
		SELECT count(*) as count
		from z_rfc_store_47_it_ztls  WHERE 1=1
		<dynamic>
			<!-- <isNotEmpty prepend="and" property="saledatefrom">
				saledate
			   </isNotEmpty>
			<isNotEmpty prepend="between" property="saledatefrom">
				#saledatefrom#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="saledateto">
				#saledateto#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="kunnr">
				customerid like
				'%$kunnr$'   
			   </isNotEmpty> -->
			<isNotEmpty prepend="and" property="vipid">
				SORT2 like '%$vipid$%'
			</isNotEmpty>
		<!-- <isNotEmpty prepend="and" property="ordertype">
				ordertype= #ordertype#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="werks">
				head.storeid= #werks#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="batchno">
				(select count(*) from
				aig_orderitem item where BATCHNUMBER like #batchno#
				and
				head.salesorderid
				=item.salesorderid) > 0
		   </isNotEmpty> -->	
		</dynamic>
	</select>



	<update id="updateorderhead" parameterClass="dto">
		update aig_orderhead
		set
		sapsalesorderid=#sapsalesorderid#,ordertype=#ordertype#,
		salepromotioncode=#salepromotioncode#,orderreason=#orderreason#,storeid=#storeid#,operator=#operator#,
		remarks=#remarks#,depositid=#depositid#,saledate=#saledate#,
		customerid=#customerid#,cashcoupon=#cashcoupon#,salesclerk=#salesclerk#,storereceipt=#storereceipt#,
		paymentaccno=#paymentaccno#,amountcollected=#amountcollected#,
		paymentmethod=#paymentmethod#,vipcard=#vipcard#,orderflag=#orderflag#,deliverydate=#deliverydate#,
		cardexpired=#cardexpired#,totalmoney=#totalmoney#,
		resalesorderid=#resalesorderid#,vipname=#vipname#,statementid=#statementid#
		,cash=#cash#
		,unionpay=#unionpay#,shoppingcard=#shoppingcard#,subscription=#subscription#
		where salesorderid=#salesorderid=#
	</update>

	<update id="updateorderitem" parameterClass="dto">
		update aig_orderitem
		set
		upsalesorderitem=#upsalesorderitem#,
		orderitemtype=#orderitemtype#,storeid=#storeid#,materialnumber=#materialnumber#,batchnumber=#batchnumber#,
		salesquantity=#salesquantity#,storagelocation=#storagelocation#,netprice=#netprice#,
		goodsprocessingfee=#goodsprocessingfee#,goldprice=#goldprice#,totalamount=#totalamount#,tagprice=#tagprice#,
		goldweight=#goldweight#,customersdiscount=#customersdiscount#,
		storediscount=#storediscount#,unit=#unit#,changefee=#changefee#,otherfee=#otherfee#,
		exchangepint=#exchangepint#,lowerlevelsnumber=#lowerlevelsnumber#,productpictureurl=#productpictureurl#,
		statementid=#statementid#,settlementrate=#settlementrate#,settlementamount=#settlementamount#,
		originalsettlementrate=#originalsettlementrate#,originalsettlementamount=#originalsettlementamount#,
		materialclassificationcode=#materialclassificationcode#,materialdesc=#materialdesc#
		where salesorderid=#salesorderid=# and salesorderitem=#salesorderitem#
	</update>

	<delete id="deleteorderItem" parameterClass="map">
		DELETE
		FROM
		aig_orderitem
		WHERE salesorderid =#salesorderid#
	</delete>


	<delete id="deleteorderhead" parameterClass="map">
		DELETE
		FROM
		aig_orderhead
		WHERE salesorderid =#salesorderid#
	</delete>

	<update id="updateorderheadbysapvbeln" parameterClass="map">
		UPDATE
		aig_orderhead
		set sapsalesorderid =#sapsalesorderid#
		,orderflag=#orderflag#,operatedatetime=
		#operatedatetime#
		WHERE
		salesorderid
		=#salesorderid#
	</update>

	<update id="updateorderheadbyDelivery" parameterClass="map">
		UPDATE
		aig_orderhead
		set deliveryordernumber=#deliveryordernumber#,
		materialdocumber=#materialdocumber#
		,orderflag=#orderflag#,operatedatetime=
		#operatedatetime#
		WHERE
		salesorderid =#salesorderid#
	</update>

	<update id="updateByjsb" parameterClass="map">
		UPDATE EA_DEMO_BYJSB SET
		fyze = #fyze# WHERE sxh = #sxh#
	</update>

	<update id="updateByjsb2" parameterClass="map">
		UPDATE EA_DEMO_BYJSBx
		SET
		fyze = #fyze# WHERE sxh = #sxh#
	</update>


	<select id="getMemberInfo" parameterClass="map" resultClass="dto">
		select h.* from z_rfc_store_05_gt_vip h
		where kunn2=#werks# and
		h.PARVO='' AND H.NAME1='未激活会员卡' and
	    KONDA=#cardType# order by h.kunnr
		limit 1
	</select>
	
	
	<select id="getMemberByPhone" parameterClass="map" resultClass="java.lang.Integer">
		select count(*) from z_rfc_store_05_gt_vip
		where sort1 = #regPhone#
	</select>
	
	<select id="getCustomId" parameterClass="map" resultClass="java.lang.String">
		select customid from eadept where deptid=#deptId#
	</select>

	<update id="updateHYXM" parameterClass="map">
		UPDATE hy_hyxxb SET
		hyxm =
		#regname# WHERE HYBH = #customerid#
	</update>


	<select id="getDiscount" parameterClass="dto" resultClass="dto">
	<![CDATA[
		select kschl,kbetr from z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara b on a.MATNR = b.MATNR left join z_rfc_store_02_it_zpjg c on b.KONDM = c.KONDM
		where a.CHARG = #charg# AND c.KUNRE LIKE '$werks$%' AND DATAB <= #currDate# AND DATBI>=#currDate# ORDER BY DATBI
	]]>
	</select>


	<select id="getDiscount1ByCharg" parameterClass="dto" resultClass="Integer">
	<![CDATA[
		select ifnull((select kbetr from z_rfc_store_02_it_zpjg a
		where (a.kondm = '' or a.kondm is null ) and a.CHARG = #charg# and kschl = 'ZZK1'
		AND a.KUNRE LIKE '$werks$%' AND DATAB <= #saledate# AND DATBI>=#saledate# ORDER BY DATBI LIMIT 1),
		(select kbetr from z_rfc_store_02_it_zpjg a
		where (a.kondm = (SELECT KONDM FROM z_rfc_store_01_it_mara WHERE MATNR=#matnr#) ) and (a.CHARG ='' or a.CHARG IS NULL) and kschl = 'ZZK1'
		AND a.KUNRE LIKE '$werks$%' AND DATAB <= #saledate# AND DATBI>=#saledate# ORDER BY DATBI LIMIT 1)
		) kbetr 
	]]>
	</select>

	<select id="getDiscount2ByCharg" parameterClass="dto" resultClass="Integer">
	<![CDATA[
		select ifnull((select kbetr from z_rfc_store_02_it_zpjg a
		where (a.kondm = '' or a.kondm is null ) and a.CHARG = #charg# and kschl = 'ZZK2'
		AND a.KUNRE LIKE '$werks$%' AND DATAB <= #saledate# AND DATBI>=#saledate# ORDER BY DATBI LIMIT 1),
		(select kbetr from z_rfc_store_02_it_zpjg a
		where (a.kondm = (SELECT KONDM FROM z_rfc_store_01_it_mara WHERE MATNR=#matnr#) ) and (a.CHARG ='' or a.CHARG IS NULL) and kschl = 'ZZK2'
		AND a.KUNRE LIKE '$werks$%' AND DATAB <= #saledate# AND DATBI>=#saledate# ORDER BY DATBI LIMIT 1)
		) kbetr 
	]]>
	</select>


	<select id="getKunnrDiscount" parameterClass="dto" resultClass="string">
		select kbetr from z_rfc_store_05_gt_vip a inner join
		z_rfc_store_02_it_zpjg b on a.KONDA = b.KONDA
		where a.KUNNR=#kunnr#
		<!--and b.MATNR=#matnr# -->
		limit 1
	</select>



	<update id="addEmpIntegral" parameterClass="map">
		UPDATE
		z_rfc_store_05_gt_vip SET
		ZJF = ZJF+#integral# , ZHYJF =ZHYJF +
		#integral#
		where KUNNR=#customerid#
	</update>

	<update id="reduceEmpIntegral" parameterClass="map">
		UPDATE
		z_rfc_store_05_gt_vip SET
		ZJF = ZJF-#integral# , ZHYJF =ZHYJF -
		#integral#
		where KUNNR=#customerid# 
	</update>
	
	<update id="reduceMatnrStore" parameterClass="map">
		UPDATE
		z_rfc_store_20_gt_stock SET
		LABST = LABST + #salesquantity# 
		where MATNR=#materialnumber# and WERKS=#storeid# and LGORT=#storagelocation#
	</update>
	
	<update id="insertMatnrStore" parameterClass="map">
		insert into 
		z_rfc_store_20_gt_stock (WERKS,LGORT,CHARG,MATNR,LABST,MEINS) 
		values(#storeid#,#storagelocation#,#batchnumber#,#materialnumber#,#salesquantity#,'PC')
	</update>
	
	
	<select id="ifExistsMatnr" parameterClass="dto" resultClass="int">
		select count(*) from z_rfc_store_20_gt_stock where MATNR=#materialnumber# 
		and WERKS=#storeid# and LGORT=#storagelocation#
	</select>
	
	<select id="ifExistsCharg46" parameterClass="dto" resultClass="int">
		select count(*) from z_rfc_store_46_it_stock where CHARG=#batchnumber# 
		and WERKS=#storeid# and LGORT=#storagelocation#
	</select>
	
	<select id="ifExistsCharg48" parameterClass="dto" resultClass="int">
		select count(*) from z_rfc_store_48_it_stock where CHARG=#batchnumber# 
		and WERKS=#storeid# and LGORT=#storagelocation#
	</select>

	
	<update id="reduceChargStore46" parameterClass="map">
		UPDATE
		z_rfc_store_46_it_stock a SET
		LABST = LABST + (CASE MEINS WHEN 'G' THEN ABS(#goldweight#)*#salesquantity# ELSE #salesquantity# END)
		where charg=#batchnumber# and WERKS=#storeid# and LGORT=#storagelocation#
	</update>
	<update id="reduceChargStore48" parameterClass="map">
		UPDATE
		z_rfc_store_48_it_stock SET
		LABST = LABST + (CASE MEINS WHEN 'G' THEN ABS(#goldweight#)*#salesquantity# ELSE #salesquantity# END) 
		where charg=#batchnumber# and WERKS=#storeid# and LGORT=#storagelocation#
	</update>
	
	<update id="insertChargStore" parameterClass="map">
		insert into 
		z_rfc_store_46_it_stock (WERKS,LGORT,CHARG,MATNR,LABST,MEINS) 
		values(#storeid#,#storagelocation#,#batchnumber#,#materialnumber#,
		(CASE (select meins from z_rfc_store_01_it_mara where matnr = #materialnumber# limit 1) WHEN 'G' THEN ABS(#goldweight#)*#salesquantity# ELSE #salesquantity# END),
		(select meins from z_rfc_store_01_it_mara where matnr = #materialnumber#  limit 1))
	</update>
	

	<select id="getCustommadeList" resultClass="dto" parameterClass="dto">
		SELECT choiceorderid, saporderid, type, totalmoney, quantity,
		custommade, remark
		FROM aig_choiceorderheader WHERE custommade = 'X'
		AND werks = #werks# and
		vipid like '$vipid$%' and orderflag = 'NO'
	</select>



	<select id="getCustommadeInfo" resultClass="dto" parameterClass="dto">
		SELECT choiceorderid, saporderid, type, ordertime, operatordate,
		orderflag, werks, totalmoney, telephone, quantity, custommade,
		remark
		FROM aig_choiceorderheader WHERE choiceorderid=#choiceorderid# and
		orderflag='NO' limit 1
	</select>

	<select id="getCustommadeItem" resultClass="dto" parameterClass="dto">
		SELECT choiceorderid, saporderid, choiceorderitem, upchoiceorderitem,
		batchnumber, materialnumber,
		materialdesc, quantity,
		goldType,
		goldweight, technics, goodsize, retailPrice,
		toneType, toneweight,
		mainToneStyle, toneColor, toneNeatness, toneshape, ifinlay,
		ifNeedLessTone,
		toneFireColor, goodTotalWeight,
		certificate,
		lessToneType, littleTotal, productpictureurl, remark, oldRetailPrice,
		oldYbzjbPrice, oldTonePrice,
		oldTechnicsPrice, extwg, matkl, kbetr,
		oldCostPrice, selectWerks, style, series
		FROM
		aig_choiceorderitem WHERE
		choiceorderid=#choiceorderid#
	</select>

	<select id="getCurrentIntegral" resultClass="string" parameterClass="dto">
		select ifnull(
		(select DISTINCT b.KBETR from z_rfc_store_01_it_mara a
		inner join
		z_rfc_store_02_it_zpjg b on a.KONDM = b.KONDM
		where KSCHL =
		'ZJF2' and a.MATNR=#matnr#
		and KUNRE LIKE '$werks$%'
		and b.datab <![CDATA[<=]]>
		#orderdate# and b.datbi >= #orderdate# AND B.KDGRP = (select CASE
		ZHYJF
		WHEN '0.00' THEN '02'
		ELSE '01'
		END KOGRT
		from z_rfc_store_05_gt_vip
		where KUNNR=#kunnr#)
		limit 1)
		,
		(select DISTINCT b.KBETR from
		z_rfc_store_01_it_mara a inner join
		z_rfc_store_02_it_zpjg b on a.KONDM
		= b.KONDM
		where KSCHL = 'ZJF2' and a.MATNR=#matnr#
		and (KUNRE = '' OR KUNRE IS NULL)
		and b.datab <![CDATA[<=]]>
		#orderdate# and b.datbi >= #orderdate#
		AND B.KDGRP = (select CASE
		ZHYJF
		WHEN '0.00' THEN '02'
		ELSE '01'
		END KOGRT
		from z_rfc_store_05_gt_vip
		where KUNNR=#kunnr#)
		limit 1)
		) KBETR
	</select>

	<select id="getThankIntegral" resultClass="string" parameterClass="dto">
		select DISTINCT b.KBETR from z_rfc_store_01_it_mara a
		inner join z_rfc_store_02_it_zpjg b on a.KONDM = b.KONDM
		where KSCHL =
		'ZJF5' limit 1
	</select>

	<select id="getMatnrGift" resultClass="dto" parameterClass="dto">
		select *,(select maktx from z_rfc_store_01_it_mara a where
		a.matnr=c.matnr) name from z_rfc_store_21_it_ztxlzp c
		inner join
		z_rfc_store_20_gt_stock d on c.matnr=d.matnr where c.ZCPXL in
		(select
		distinct b.ZCPXL from z_rfc_store_01_it_mara a left join
		z_rfc_store_07_it_ztzmsx b
		on a.BISMT=b.ZZMHN where a.MATNR=#matnr#)
		and
		d.labst > 0
	</select>

	<!-- select * from z_rfc_store_23_gt_zcsmx a where a.OBJEK=#werks# -->
	<select id="getSalepromotion" resultClass="dto" parameterClass="dto">
		select DISTINCT kbetr,a.aktnr,aktkt from z_rfc_store_02_it_zpjg a left
		join z_rfc_store_23_gt_zcsmx b
		on a.AKTNR = b.AKTNR where kschl='ZZK2'
		and charg=#charg#
		and KUNRE like '$werks$%'
		AND a.DATAB <![CDATA[<= ]]>#orderdate#
		AND a.DATBI<![CDATA[ >= ]]>
		#orderdate#
		order by a.DATAB desc
	</select>

	<select id="getSalepromotionForKondm" resultClass="dto" parameterClass="dto">
		select DISTINCT kbetr,a.aktnr,aktkt from z_rfc_store_02_it_zpjg a left
		join z_rfc_store_23_gt_zcsmx b
		on a.AKTNR = b.AKTNR where kschl='ZZK2'
		and charg='' and a.kondm =
		(select kondm from
		z_rfc_store_01_it_mara c
		where c.matnr=#matnr#
		limit 1)
		and KUNRE like '$werks$%'
		AND a.DATAB <![CDATA[ <= ]]>#orderdate#
		AND a.DATBI <![CDATA[ >= ]]>#orderdate#
		order by a.DATAB desc
	</select>


	<select id="getFrontMoneyList" resultClass="dto" parameterClass="dto">
		SELECT SALESORDERID, OPERATEDATETIME, SAPSALESORDERID, ORDERTYPE,
		SALEPROMOTIONCODE, ORDERREASON,
		STOREID, OPERATOR, REMARKS, DEPOSITID,
		SALEDATE, CUSTOMERID, CASHCOUPON,
		SALESCLERK, STORERECEIPT,
		PAYMENTACCNO, AMOUNTCOLLECTED, PAYMENTMETHOD, VIPCARD, ORDERFLAG,
		DELIVERYDATE,
		CARDEXPIRED,
		TOTALMONEY, RESALESORDERID, VIPNAME,
		STATEMENTID, DELIVERYORDERNUMBER,
		MATERIALDOCUMBER,
		INSERTDATETIME,
		CASH,
		UNIONPAY, SHOPPINGCARD, SUBSCRIPTION, referrer, thankIntegral
		FROM aig_orderhead where VIPCARD = #vipid# AND ORDERTYPE in(
		'ZYS3','ZJM3','ZYS8','ZJM8') and SAPSALESORDERID <![CDATA[<>]]>
		''
		and STOREID=#werks# and orderflag = 'UO'
	</select>

	<select id="getFrontMoneyInfo" resultClass="dto" parameterClass="dto">
		SELECT SALESORDERID, OPERATEDATETIME, SAPSALESORDERID, ORDERTYPE,
		SALEPROMOTIONCODE, ORDERREASON,
		STOREID, OPERATOR, REMARKS,
		DEPOSITID,
		SALEDATE, CUSTOMERID, CASHCOUPON,
		SALESCLERK, STORERECEIPT,
		PAYMENTACCNO, AMOUNTCOLLECTED, PAYMENTMETHOD, VIPCARD, ORDERFLAG,
		DELIVERYDATE,
		CARDEXPIRED,
		TOTALMONEY, RESALESORDERID, VIPNAME,
		STATEMENTID, DELIVERYORDERNUMBER,
		MATERIALDOCUMBER,
		INSERTDATETIME,
		CASH, UNIONPAY, SHOPPINGCARD, SUBSCRIPTION, referrer, thankIntegral
		FROM aig_orderhead where SALESORDERID=#orderid# and orderflag='UO'
	</select>
	<!-- 20150707 将金额限制去掉 -->
	<select id="getIntegralMatnrInfo" resultClass="dto" parameterClass="dto">
		select a.matnr, b.maktx,abs(kbetr) kbetr
		from z_rfc_store_02_it_zpjg a
		inner join z_rfc_store_01_it_mara b on a.matnr=b.matnr
		where kschl = 'ZJF7'
		<!--  and
		(select labst from z_rfc_store_20_gt_stock where matnr=a.matnr
		and
		werks=#werks# and lgort='0014' limit 1) >0 -->
		<!--<dynamic>
			 <isNotEmpty property="ordertype" prepend="and">
				AUART_SD =
				#ordertype#
			</isNotEmpty> 
			这里去掉 将金额限制去掉
			<isNotEmpty property="zjf" prepend="and">
				abs(kbetr)<![CDATA[ <= ]]>(#zjf# + 10)
			</isNotEmpty>
		</dynamic>-->
	</select>

	<select id="getAllGiftInfo" resultClass="dto" parameterClass="dto">
		select b.matnr, b.maktx,(select labst from z_rfc_store_20_gt_stock where matnr=b.matnr and
		werks=#werks# and lgort='0014' LIMIT 1) LABST from z_rfc_store_01_it_mara b where 1=1
		and b.matnr like 'V%' and
		(select labst from z_rfc_store_20_gt_stock where matnr=b.matnr and
		werks=#werks# and lgort='0014' limit 1) >0

		<!-- select a.matnr, b.maktx,abs(kbetr) kbetr from z_rfc_store_02_it_zpjg a inner join z_rfc_store_01_it_mara b on a.matnr=b.matnr where 1=1 and a.matnr like 'V%' and (select labst from z_rfc_store_20_gt_stock 
			where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) >0 -->
	</select>

	<select id="getFrontMoneyItem" resultClass="dto" parameterClass="dto">
		SELECT * FROM aig_orderitem where SALESORDERID =
		(select SALESORDERID from aig_orderhead where sapSALESORDERID = #orderid#)
	</select>
	<select id="getIntegralMatnrItem" resultClass="dto" parameterClass="dto">
		SELECT *,(select labst from z_rfc_store_20_gt_stock
		where matnr=a.matnr and werks=#werks# and lgort='0014' limit 1) labst
		FROM
		z_rfc_store_01_it_mara a where matnr=#matnr# 
	</select>

	<select id="getIntegralScale" resultClass="Integer" parameterClass="dto">
		select KBETR from z_rfc_store_02_it_zpjg where
		KSCHL='ZJF2' AND KONDM =
		(SELECT KONDM FROM z_rfc_store_01_it_mara
		WHERE
		MATNR=#matnr#) limit 1
	</select>

	<update id="deductInventoryByCharg" parameterClass="dto">
		update
		z_rfc_store_46_it_stock set LABST = LABST - (CASE MEINS WHEN 'G' THEN ABS(#goldweight#)*#salesquantity# ELSE #salesquantity# END)
		where
		werks=#storeid# and charg=#batchnumber# and lgort=#storagelocation#
	</update>

	<update id="deductInventoryByChargForK" parameterClass="dto">
		update
		z_rfc_store_48_it_stock set LABST = LABST - (CASE MEINS WHEN 'G' THEN ABS(#goldweight#)*#salesquantity# ELSE #salesquantity# END)
		where
		werks=#storeid# and charg=#batchnumber# and lgort=#storagelocation#
	</update>

	<select id="getStockInfoByCharg" parameterClass="dto" resultClass="dto">
		select * from z_rfc_store_46_it_stock
		where werks=#storeid#
		and charg=#batchnumber# and lgort=#storagelocation# limit 1
	</select>

	<select id="getStockInfoByChargForK" parameterClass="dto" resultClass="dto">
		select * from z_rfc_store_48_it_stock
		where werks=#storeid#
		and charg=#batchnumber# and lgort=#storagelocation# limit 1
	</select>

	<select id="getMeinsByMatnr" parameterClass="dto" resultClass="dto">
		select MEINS from z_rfc_store_01_it_mara where matnr=#materialnumber# limit 1
	</select>

	<update id="deductInventoryByMatnr" parameterClass="dto">
		update
		z_rfc_store_20_gt_stock set LABST = LABST - (CASE MEINS WHEN 'G' THEN #goldweight#*#salesquantity# ELSE #salesquantity# END)
		where
		werks=#storeid# and matnr=#materialnumber# and lgort=#storagelocation#
	</update>

	<update id="deductInventoryByMatnrForK" parameterClass="dto">
		update
		z_rfc_store_48_it_stock set LABST = LABST - (CASE MEINS WHEN 'G' THEN #goldweight#*#salesquantity# ELSE #salesquantity# END)
		where
		werks=#storeid# and matnr=#materialnumber# and lgort=#storagelocation# and (charg = '' or charg is null)
	</update>

	<select id="getStockInfoByMatnr" parameterClass="dto" resultClass="double">
		select LABST from z_rfc_store_20_gt_stock
		where
		werks=#storeid# and
		matnr=#materialnumber# limit 1
	</select>


	<select id="getLgortInfo" parameterClass="string" resultClass="dto">
		select WERKS, LGORT, LGOBE
		from z_rfc_store_06_it_t001l
		where
		werks=#werks# and lgort in ('0001','0002','0008','0017')
	</select>

	<select id="validateRegistPhone" parameterClass="dto" resultClass="dto">
		select *
		from z_rfc_store_05_gt_vip
		where SORT1 = #regPhone#
		limit 1
	</select>

	<update id="updateFrontMoneyInfo" parameterClass="dto">
		update
		aig_orderhead set orderflag = #orderflag# where
		SALESORDERID=#oldsaleorderid#
	</update>

	<update id="updateChoiceOrderInfo" parameterClass="dto">
		update
		aig_choiceorderheader set orderflag = #orderflag# where
		choiceorderid=#choiceorderid#
	</update>


	<select id="getGroupGoodsItem" parameterClass="dto" resultClass="dto">
		select a.CHARG cpbm ,b.MAKTX plmc,b.meins,
		(select kbetr from
		z_rfc_store_02_it_zpjg where charg =a.charg and kunre like '$werks$%'
		and KOSRT = #kosrt# and KSCHL='ZZH1' and datab <![CDATA[<=]]>current_date
		and datbi >= current_date limit 1) bqj,
		a.ZCLZL jlzl,a.MATNR bkbh,
		b.ZMATNRT zp,
		b.ZJLBM sjczbm,
		(select labst from z_rfc_store_46_it_stock
		where charg=a.charg and
		werks=#werks# and lgort='0001') labst,
		(select
		lgort from
		z_rfc_store_46_it_stock where charg=a.charg and
		werks=#werks# and
		lgort='0001') lgort,
		b.MATKL,
		(select KBSTAT from
		z_rfc_store_04_gt_zpcjg where charg =a.charg and matnr = a.matnr and kunre
		like '$werks$%'
		and datab <![CDATA[<=]]>current_date
		and datbi >= current_date order by datab desc limit 1) KBSTAT
		,b.BISMT
		from
		z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara b on
		a.MATNR = b.MATNR
		where a.CHARG in(select charg from
		z_rfc_store_02_it_zpjg where
		KOSRT =
		#kosrt# and kunre like '$werks$%')

		<!-- select a.CHARG cpbm ,b.MAKTX plmc,c.KBETR bqj,a.ZCLZL jlzl,a.MATNR bkbh, b.ZMATNRT zp, b.ZJLBM sjczbm, d.labst,d.lgort, b.MATKL,c.KBSTAT,b.BISMT from z_rfc_store_03_it_charg a left join z_rfc_store_01_it_mara 
			b on a.MATNR = b.MATNR left join z_rfc_store_04_gt_zpcjg c on a.CHARG = c.CHARG left join z_rfc_store_46_it_stock d on a.CHARG = d.CHARG where a.CHARG in(select charg from z_rfc_store_02_it_zpjg where 
			KOSRT = #kosrt# and werks like '$werks$%') -->
	</select>
	<select id="getGroupGoods" parameterClass="dto" resultClass="String">
		select kosrt from
		z_rfc_store_02_it_zpjg where charg =#charg# and kunre like '$werks$%'
	    and KSCHL='ZZH1' and datab <![CDATA[<=]]>current_date
		and datbi >= current_date limit 1

	</select>
	
	<select id="getIfNeedNE" parameterClass="dto" resultClass="dto">
		SELECT charg, MAKTX FROM z_rfc_store_29_it_zttj where <!-- werks=#werks#  -->	
		and CHARG=#charg# limit 1
	</select>
	<select id="getGiftPrice" parameterClass="dto" resultClass="Double">
		SELECT zjp FROM z_rfc_store_29_it_ztzl where werks=#werks# limit 1
	</select>

	<!-- 取促销扣点   || 20140211增加按促销代码取值 -->
	<select id="getZ087Price" parameterClass="dto" resultClass="Double">
		select ifnull(
			(select KBETR from z_rfc_store_54_it_z087 
			  where KSCHL='Z087' and KUNRE LIKE '$werks$%' 
			    and (KONDM = '' or KONDM IS NULL) and CHARG = #batchnumber# 
			    and aktnr = #salepromotion#
			    and datab <![CDATA[<=]]>#orderdate# and datbi >= #orderdate# limit 1),  
			(select KBETR from z_rfc_store_02_it_zpjg 
			  where KSCHL='Z087' and KUNRE LIKE '$werks$%' 
			    and KONDM = (select kondm from z_rfc_store_01_it_mara where matnr=#materialnumber#) 
			    and aktnr = #salepromotion#
			    and datab <![CDATA[<=]]>#orderdate# and datbi >= #orderdate# limit 1)
		) aaa
	</select>
	
	<!-- 取商场扣点 -->
	<select id="getZ082Price" parameterClass="dto" resultClass="Double">
		select ifnull(
			(select KBETR from z_rfc_store_02_it_zpjg 
			  where KSCHL='Z082' and KUNRE LIKE '$werks$%' 
			    and (KONDM = '' or KONDM IS NULL) 
			    and CHARG = #batchnumber# 
			    and datab <![CDATA[<=]]>#orderdate# and datbi >= #orderdate# limit 1),
			(select KBETR from z_rfc_store_02_it_zpjg 
			  where KSCHL='Z082' and KUNRE LIKE '$werks$%' 
			    and KONDM = (select kondm from z_rfc_store_01_it_mara where matnr=#materialnumber#) 
			    and datab <![CDATA[<=]]>#orderdate# and datbi >= #orderdate# limit 1)
		) aaa
	</select>

	<select id="getOldGoldType" parameterClass="dto" resultClass="dto">
		select * from z_rfc_store_01_it_mara where matkl = 'JJ'
	</select>
	<select id="getZjbgf" parameterClass="dto" resultClass="String">
		select
		ZJBFY from z_rfc_store_42_it_zcharg_jg where charg=#charg#
		limit 1
	</select>
	<select id="getPersonProcessPrice" parameterClass="dto" resultClass="dto">
		select ZGDO,ZGFBS, (SELECT ZJBFY FROM z_rfc_store_42_it_zcharg_jg WHERE CHARG=#charg# limit 1)
	jbfy from z_rfc_store_51_it_zggf where werks LIKE '$werks$%' AND kondm = #kondm# and
	(SELECT ZJBFY FROM z_rfc_store_42_it_zcharg_jg WHERE CHARG=#charg# limit 1)>=ZGFS AND 
	(SELECT ZJBFY FROM z_rfc_store_42_it_zcharg_jg WHERE CHARG=#charg# limit 1) <![CDATA[<=]]>zgfx limit 1
	</select>

	<update id="submitMoveLgort" parameterClass="dto">
		UPDATE
		z_rfc_store_46_it_stock SET LGORT = #lgortto#
		WHERE WERKS = #werks# and
		LGORT = #lgort# and CHARG = #charg#
	</update>

	<select id="getassistantnames" parameterClass="dto" resultClass="String">
		select assistant_name from aig_assistant_info where assistantno in
		<dynamic>
			<isNotEmpty property="salesIds">
				<iterate property="salesIds" open="(" close=")" conjunction=",">
					#salesIds[]#
				</iterate>
				or assistant_name in
				<iterate property="salesIds" open="(" close=")" conjunction=",">
					#salesIds[]#
				</iterate>
			</isNotEmpty>
			<isEmpty property="salesIds">
				('')
			</isEmpty>
		</dynamic>
	</select>


	<select id="getPackageInfo" parameterClass="dto" resultClass="dto">
		select * from z_rfc_store_20_gt_stock a inner join
		z_rfc_store_01_it_mara b on a.MATNR=b.MATNR
		where LGORT='0012' and
		werks=#werks#
		and b.matkl='BC' and LABST > 0 
	</select>
	
	
	<update id="updateorderprice" parameterClass="dto">
		update aig_orderhead set cash = #cash#,unionpay=#unionpay#,shoppingcard=#shoppingcard#,
		storereceipt=#shopnumber#,remarks=#remark#,SALEDATE=#ordertime# where salesorderid=#salesorderid#
	</update>
	
	<select id="getIfHaveGiveGift" parameterClass="dto" resultClass="string">
		select MATERIALNUMBER from aig_orderitem a inner join 
		aig_orderhead b on a.SALESORDERID=b.SALESORDERID  where vipcard = #vipid# and (MATERIALNUMBER like 'VS%' OR MATERIALNUMBER LIKE 'VJ%')
		and b.SALEDATE >= DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY)
	</select>
	
	<insert id="createPrint" parameterClass="dto" >
		insert into aig_print(SALESORDERID,cnt,date) values (#ywxh#,1,now())
	</insert>
	<update id="updatePrint" parameterClass="dto">
		update aig_print set cnt = cnt + 1 where printid = #printid#
	</update>
	<select id="selectPrint" parameterClass="dto" resultClass="dto">
		select * from aig_print where SALESORDERID = #ywxh#
	</select>
</sqlMap>
